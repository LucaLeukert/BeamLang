type String {
    data: any,
    length: fn(String) -> number,
    chars: fn(String) -> Iterator<char>,
    concat: fn(String, String) -> String
}

@external(elixir, "BeamLang.Runtime", "typeof_data")
fn typeof_data(value: any) -> any;

@external(elixir, "BeamLang.Runtime", "string_length_data")
fn string_length_data(value: any) -> number;

@external(elixir, "BeamLang.Runtime", "string_concat_data")
fn string_concat_data(left: any, right: any) -> any;

@external(elixir, "BeamLang.Runtime", "string_chars_data")
fn string_chars_data(value: any) -> any;

@external(elixir, "BeamLang.Runtime", "println")
fn println(value: any) -> void;

@external(elixir, "BeamLang.Runtime", "print")
fn print(value: any) -> void;

fn typeof(value: any) -> String {
    let data = typeof_data(value);
    return string_new(data);
}

internal fn string_new(data: any) -> String {
    return { data = data, length = string_length, chars = string_chars, concat = string_concat };
}

internal fn string_length(self: String) -> number {
    return string_length_data(self->data);
}

internal fn string_concat(self: String, right: String) -> String {
    let data = string_concat_data(self->data, right->data);
    return string_new(data);
}

internal fn string_chars(self: String) -> Iterator<char> {
    let data = string_chars_data(self->data);
    return iterator_from_list(data);
}
